# ìŠ¬ë™ ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ê³„ì„œ ğŸ“§

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

### ëª©ì 
ìƒë‹´ì‹ ì²­ì´ ì™„ë£Œë  ë•Œë§ˆë‹¤ ìŠ¬ë™ ì±„ë„ë¡œ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ë°œì†¡í•˜ì—¬ ë¹ ë¥¸ ëŒ€ì‘ê³¼ ê³ ê° ì„œë¹„ìŠ¤ í–¥ìƒì„ ë„ëª¨

### ë²”ìœ„
- ê°€ì´ë“œ ìƒë‹´ì‹ ì²­ ì™„ë£Œ ì‹œ ìŠ¬ë™ ì•Œë¦¼
- ììœ  ìƒë‹´ì‹ ì²­ ì™„ë£Œ ì‹œ ìŠ¬ë™ ì•Œë¦¼
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ ê¸°ëŠ¥

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ í”Œë¡œìš°
```
ì‚¬ìš©ì ìƒë‹´ì‹ ì²­ â†’ API ì—”ë“œí¬ì¸íŠ¸ â†’ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ â†’ ìŠ¬ë™ ì›¹í›… í˜¸ì¶œ â†’ ìŠ¬ë™ ì±„ë„ ì•Œë¦¼
```

### êµ¬ì„± ìš”ì†Œ
1. **Frontend**: ìƒë‹´ì‹ ì²­ í¼
2. **Backend API**: ìƒë‹´ ì²˜ë¦¬ ë° ìŠ¬ë™ ì•Œë¦¼ íŠ¸ë¦¬ê±°
3. **Slack Webhook**: ë©”ì‹œì§€ ë°œì†¡ ì¸í„°í˜ì´ìŠ¤
4. **Database**: ìƒë‹´ ë°ì´í„° ë° ì•Œë¦¼ ë¡œê·¸ ì €ì¥

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
```json
{
  "@slack/webhook": "^7.0.2",
  "node-cron": "^3.0.3"
}
```

### í™˜ê²½ ë³€ìˆ˜
```env
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_CHANNEL=#ìƒë‹´ì‹ ì²­
SLACK_USERNAME=ìƒë‹´ì•Œë¦¼ë´‡
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
utils/
â”œâ”€â”€ slackNotification.ts      # ìŠ¬ë™ ì•Œë¦¼ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ notificationTemplates.ts  # ë©”ì‹œì§€ í…œí”Œë¦¿
â””â”€â”€ notificationQueue.ts      # ì•Œë¦¼ í ê´€ë¦¬

pages/api/
â”œâ”€â”€ consultation-submit.ts    # ìƒë‹´ì‹ ì²­ API (ê¸°ì¡´)
â””â”€â”€ admin/
    â””â”€â”€ send-notification.ts  # ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ API

types/
â””â”€â”€ slack.ts                 # ìŠ¬ë™ ê´€ë ¨ íƒ€ì… ì •ì˜
```

---

## ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

### 1. ìŠ¬ë™ ì•Œë¦¼ ìœ í‹¸ë¦¬í‹° (`utils/slackNotification.ts`)

```typescript
interface SlackNotificationData {
  consultationType: 'guided' | 'free';
  clientName: string;
  email: string;
  phone: string;
  company?: string;
  projectType?: string;
  budget?: string;
  message?: string;
  createdAt: string;
  consultationNumber: string;
}

interface SlackMessage {
  text: string;
  blocks: SlackBlock[];
  username?: string;
  channel?: string;
  icon_emoji?: string;
}

// ë©”ì¸ ì•Œë¦¼ í•¨ìˆ˜
export async function sendSlackNotification(data: SlackNotificationData): Promise<boolean>

// ì—ëŸ¬ ì•Œë¦¼ í•¨ìˆ˜
export async function sendErrorNotification(error: string, context: string): Promise<void>

// ì¼ì¼ ìš”ì•½ ì•Œë¦¼ í•¨ìˆ˜
export async function sendDailySummary(summaryData: DailySummaryData): Promise<void>
```

### 2. ë©”ì‹œì§€ í…œí”Œë¦¿ (`utils/notificationTemplates.ts`)

```typescript
// ê°€ì´ë“œ ìƒë‹´ í…œí”Œë¦¿
export function createGuidedConsultationMessage(data: SlackNotificationData): SlackMessage

// ììœ  ìƒë‹´ í…œí”Œë¦¿
export function createFreeConsultationMessage(data: SlackNotificationData): SlackMessage

// ê¸´ê¸‰ ìƒë‹´ í…œí”Œë¦¿
export function createUrgentConsultationMessage(data: SlackNotificationData): SlackMessage

// ì¼ì¼ ìš”ì•½ í…œí”Œë¦¿
export function createDailySummaryMessage(data: DailySummaryData): SlackMessage
```

### 3. ì•Œë¦¼ í ê´€ë¦¬ (`utils/notificationQueue.ts`)

```typescript
interface NotificationJob {
  id: string;
  type: 'consultation' | 'error' | 'summary';
  data: any;
  retryCount: number;
  scheduledAt: Date;
  status: 'pending' | 'processing' | 'completed' | 'failed';
}

// íì— ì•Œë¦¼ ì‘ì—… ì¶”ê°€
export async function addNotificationToQueue(job: Omit<NotificationJob, 'id' | 'retryCount' | 'status'>): Promise<void>

// í ì²˜ë¦¬
export async function processNotificationQueue(): Promise<void>

// ì‹¤íŒ¨í•œ ì•Œë¦¼ ì¬ì‹œë„
export async function retryFailedNotifications(): Promise<void>
```

---

## ğŸ”” ìŠ¬ë™ ë©”ì‹œì§€ ë””ìì¸

### ê°€ì´ë“œ ìƒë‹´ ë©”ì‹œì§€ ì˜ˆì‹œ
```json
{
  "text": "ğŸ†• ìƒˆë¡œìš´ ê°€ì´ë“œ ìƒë‹´ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!",
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "ğŸ†• ìƒˆë¡œìš´ ê°€ì´ë“œ ìƒë‹´ì‹ ì²­"
      }
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*ê³ ê°ëª…:*\ní™ê¸¸ë™"
        },
        {
          "type": "mrkdwn",
          "text": "*ì—°ë½ì²˜:*\n010-1234-5678"
        },
        {
          "type": "mrkdwn",
          "text": "*ì´ë©”ì¼:*\nhong@example.com"
        },
        {
          "type": "mrkdwn",
          "text": "*íšŒì‚¬ëª…:*\n(ì£¼)í…ŒìŠ¤íŠ¸ì»´í¼ë‹ˆ"
        }
      ]
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*í”„ë¡œì íŠ¸ ìœ í˜•:*\nì›¹ì‚¬ì´íŠ¸ ì œì‘"
        },
        {
          "type": "mrkdwn",
          "text": "*ì˜ˆì‚°:*\n300-500ë§Œì›"
        },
        {
          "type": "mrkdwn",
          "text": "*ì¼ì •:*\n1-3ê°œì›”"
        },
        {
          "type": "mrkdwn",
          "text": "*ìƒë‹´ë²ˆí˜¸:*\nGU-2024-001"
        }
      ]
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*ì¶”ê°€ ìš”ì²­ì‚¬í•­:*\në°˜ì‘í˜• ì›¹ì‚¬ì´íŠ¸ë¡œ ì œì‘ì„ ì›í•©ë‹ˆë‹¤."
      }
    },
    {
      "type": "actions",
      "elements": [
        {
          "type": "button",
          "text": {
            "type": "plain_text",
            "text": "ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™•ì¸"
          },
          "url": "https://yourdomain.com/admin/consultations/GU-2024-001",
          "style": "primary"
        },
        {
          "type": "button",
          "text": {
            "type": "plain_text",
            "text": "ê³ ê°ì—ê²Œ ì—°ë½í•˜ê¸°"
          },
          "url": "tel:010-1234-5678"
        }
      ]
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "ğŸ“… ì ‘ìˆ˜ì‹œê°„: 2024-09-21 17:30:45 | ğŸŒ IP: 192.168.1.1"
        }
      ]
    }
  ]
}
```

---

## ğŸ”Œ API í†µí•©

### 1. ê¸°ì¡´ ìƒë‹´ì‹ ì²­ API ìˆ˜ì • (`pages/api/consultation-submit.ts`)

```typescript
// ê¸°ì¡´ ë¡œì§ + ìŠ¬ë™ ì•Œë¦¼ ì¶”ê°€
export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  try {
    // 1. ìƒë‹´ ë°ì´í„° ê²€ì¦
    const validatedData = validateConsultationData(req.body);

    // 2. ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
    const consultation = await saveConsultation(validatedData);

    // 3. ìŠ¬ë™ ì•Œë¦¼ ë°œì†¡ (ë¹„ë™ê¸°)
    addNotificationToQueue({
      type: 'consultation',
      data: {
        ...consultation,
        consultationType: req.body.consultationType
      },
      scheduledAt: new Date()
    }).catch(error => {
      console.error('ìŠ¬ë™ ì•Œë¦¼ í ì¶”ê°€ ì‹¤íŒ¨:', error);
    });

    // 4. í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ
    res.status(200).json({
      success: true,
      consultationNumber: consultation.consultationNumber
    });

  } catch (error) {
    // ì—ëŸ¬ ì•Œë¦¼ë„ ìŠ¬ë™ìœ¼ë¡œ ë°œì†¡
    sendErrorNotification(error.message, 'consultation-submit').catch(console.error);
    res.status(500).json({ success: false, error: error.message });
  }
}
```

### 2. ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ API (`pages/api/admin/send-notification.ts`)

```typescript
export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  // ê´€ë¦¬ì ì¸ì¦ í™•ì¸
  if (!isAdminAuthenticated(req)) {
    return res.status(401).json({ error: 'Unauthorized' });
  }

  const { consultationId, type } = req.body;

  try {
    // ìƒë‹´ ì •ë³´ ì¡°íšŒ
    const consultation = await getConsultationById(consultationId);

    // ìŠ¬ë™ ì•Œë¦¼ ë°œì†¡
    const success = await sendSlackNotification({
      ...consultation,
      consultationType: type
    });

    if (success) {
      res.status(200).json({ success: true, message: 'ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' });
    } else {
      res.status(500).json({ success: false, message: 'ì•Œë¦¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' });
    }
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
}
```

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. í™˜ê²½ ë³€ìˆ˜ ë³´í˜¸
- `.env.local`ì— ìŠ¬ë™ ì›¹í›… URL ì €ì¥
- í”„ë¡œë•ì…˜ì—ì„œëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…
- Gitì— ì›¹í›… URLì´ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜

### 2. ê°œì¸ì •ë³´ ì²˜ë¦¬
```typescript
// ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹ í•¨ìˆ˜
function maskSensitiveData(data: SlackNotificationData): SlackNotificationData {
  return {
    ...data,
    email: maskEmail(data.email),
    phone: maskPhone(data.phone)
  };
}

function maskEmail(email: string): string {
  const [local, domain] = email.split('@');
  const maskedLocal = local.charAt(0) + '*'.repeat(local.length - 2) + local.charAt(local.length - 1);
  return `${maskedLocal}@${domain}`;
}

function maskPhone(phone: string): string {
  return phone.replace(/(\d{3})-(\d{4})-(\d{4})/, '$1-****-$3');
}
```

### 3. ì—ëŸ¬ ì²˜ë¦¬
- ìŠ¬ë™ ì•Œë¦¼ ì‹¤íŒ¨ ì‹œì—ë„ ìƒë‹´ì‹ ì²­ì€ ì •ìƒ ì²˜ë¦¬
- ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„
- ì‹¤íŒ¨ ë¡œê·¸ ê¸°ë¡

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

### 1. ì•Œë¦¼ ë°œì†¡ ë¡œê·¸ í…Œì´ë¸”

```sql
CREATE TABLE notification_logs (
  id SERIAL PRIMARY KEY,
  consultation_id VARCHAR(50) REFERENCES consultations(id),
  notification_type VARCHAR(20) NOT NULL,
  status VARCHAR(20) NOT NULL, -- 'sent', 'failed', 'retrying'
  error_message TEXT,
  sent_at TIMESTAMP,
  retry_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ëŒ€ì‹œë³´ë“œ ë©”íŠ¸ë¦­
- ì¼ì¼ ì•Œë¦¼ ë°œì†¡ ìˆ˜
- ì•Œë¦¼ ë°œì†¡ ì„±ê³µë¥ 
- í‰ê·  ë°œì†¡ ì‹œê°„
- ì¬ì‹œë„ í˜„í™©

---

## ğŸš€ êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë³¸ ì•Œë¦¼ ì‹œìŠ¤í…œ (1-2ì¼)
1. âœ… ìŠ¬ë™ ì›¹í›… ì„¤ì •
2. âœ… ê¸°ë³¸ ì•Œë¦¼ ìœ í‹¸ë¦¬í‹° êµ¬í˜„
3. âœ… ìƒë‹´ì‹ ì²­ APIì— ì•Œë¦¼ ì—°ë™
4. âœ… ê¸°ë³¸ ë©”ì‹œì§€ í…œí”Œë¦¿ ì‘ì„±

### Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (2-3ì¼)
1. âœ… ì•Œë¦¼ í ì‹œìŠ¤í…œ êµ¬í˜„
2. âœ… ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ ì¶”ê°€
3. âœ… ê´€ë¦¬ì í˜ì´ì§€ ìˆ˜ë™ ë°œì†¡ ê¸°ëŠ¥
4. âœ… ì—ëŸ¬ ì•Œë¦¼ ì‹œìŠ¤í…œ

### Phase 3: ëª¨ë‹ˆí„°ë§ ë° ìµœì í™” (1-2ì¼)
1. âœ… ì•Œë¦¼ ë¡œê·¸ ì‹œìŠ¤í…œ
2. âœ… ëŒ€ì‹œë³´ë“œ ë©”íŠ¸ë¦­ ì¶”ê°€
3. âœ… ì„±ëŠ¥ ìµœì í™”
4. âœ… ë¬¸ì„œí™” ë° í…ŒìŠ¤íŠ¸

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- ìŠ¬ë™ ë©”ì‹œì§€ ìƒì„± í•¨ìˆ˜
- ë°ì´í„° ë§ˆìŠ¤í‚¹ í•¨ìˆ˜
- API ì—”ë“œí¬ì¸íŠ¸

### 2. í†µí•© í…ŒìŠ¤íŠ¸
- ìƒë‹´ì‹ ì²­ â†’ ìŠ¬ë™ ì•Œë¦¼ ì „ì²´ í”Œë¡œìš°
- ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ í…ŒìŠ¤íŠ¸

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- ë™ì‹œ ë‹¤ë°œì  ìƒë‹´ì‹ ì²­ ì²˜ë¦¬
- ìŠ¬ë™ API ì‘ë‹µ ì‹œê°„ ì¸¡ì •
- í ì²˜ë¦¬ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

## ğŸ“š ì„¤ì • ê°€ì´ë“œ

### 1. ìŠ¬ë™ ì›¹í›… ìƒì„±
1. Slack ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì—ì„œ Apps â†’ Incoming Webhooks í™œì„±í™”
2. ì±„ë„ ì„ íƒ ë° ì›¹í›… URL ìƒì„±
3. í™˜ê²½ ë³€ìˆ˜ì— URL ì¶”ê°€

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```env
# .env.local
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
SLACK_CHANNEL=#ìƒë‹´ì‹ ì²­
SLACK_USERNAME=ìƒë‹´ì•Œë¦¼ë´‡
SLACK_ICON_EMOJI=:bell:
```

### 3. íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install @slack/webhook node-cron
npm install -D @types/node-cron
```

---

## ğŸ”® í–¥í›„ í™•ì¥ ê³„íš

### 1. ë‹¤ì±„ë„ ì•Œë¦¼
- ì´ë©”ì¼ ì•Œë¦¼ ì¶”ê°€
- SMS ì•Œë¦¼ ì—°ë™
- Discord/Teams ì—°ë™

### 2. ì§€ëŠ¥í˜• ì•Œë¦¼
- ìƒë‹´ ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ì•Œë¦¼ ë ˆë²¨ ì¡°ì •
- ì—…ë¬´ì‹œê°„ ì™¸ ì•Œë¦¼ ìŠ¤ì¼€ì¤„ë§
- ë‹´ë‹¹ìë³„ ì•Œë¦¼ ë¼ìš°íŒ…

### 3. ë¶„ì„ ë° ë¦¬í¬íŒ…
- ìŠ¬ë™ ìƒí˜¸ì‘ìš© ë¶„ì„
- ì‘ë‹µ ì‹œê°„ ì¸¡ì •
- A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•œ ë©”ì‹œì§€ ìµœì í™”

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

ì´ ì„¤ê³„ì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ êµ¬í˜„ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ê°œë°œíŒ€ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.

**ì‘ì„±ì¼**: 2024ë…„ 9ì›” 21ì¼
**ë²„ì „**: 1.0
**ì‘ì„±ì**: Claude AI Assistant