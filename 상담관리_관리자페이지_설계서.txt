# LeoFitTech ìƒë‹´ ê´€ë¦¬ ì‹œìŠ¤í…œ - ê´€ë¦¬ì í˜ì´ì§€ ì„¤ê³„ì„œ

## 1. ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 1.1 ê¸°ìˆ  ìŠ¤íƒ
- Frontend: Next.js 14 + TypeScript + Tailwind CSS
- Backend: Next.js API Routes + Supabase
- Database: PostgreSQL (Supabase)
- Real-time: Supabase Realtime
- í‘¸ì‹œ ì•Œë¦¼: Notion API + Webhook
- ì¸ì¦: JWT + Supabase Auth
- ìƒíƒœê´€ë¦¬: React Context API + Zustand

### 1.2 ì‹œìŠ¤í…œ êµ¬ì¡°
```
ìƒë‹´ì‹ ì²­ â†’ Supabase DB â†’ Real-time Update â†’ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
                    â†“
              Webhook Trigger â†’ Notion API â†’ ë…¸ì…˜ ì•Œë¦¼
```

## 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 2.1 í…Œì´ë¸” êµ¬ì¡°

#### consultations (ê¸°ì¡´ í…Œì´ë¸” í™•ì¥)
```sql
- id: UUID (Primary Key)
- consultation_number: VARCHAR(20) (Unique)
- type: ENUM('guided', 'free')
- status: ENUM('pending', 'reviewing', 'approved', 'rejected', 'completed', 'cancelled')
- priority: ENUM('low', 'normal', 'high', 'urgent')
- assigned_to: UUID (ê´€ë¦¬ì ID, Foreign Key)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
- reviewed_at: TIMESTAMP
- completed_at: TIMESTAMP
- client_info: JSONB (ì—°ë½ì²˜, íšŒì‚¬ì •ë³´ ë“±)
- project_details: JSONB (í”„ë¡œì íŠ¸ ìƒì„¸ì •ë³´)
- budget_range: VARCHAR(50)
- timeline: VARCHAR(50)
- notes: TEXT (ê´€ë¦¬ì ë©”ëª¨)
- tags: VARCHAR[] (íƒœê·¸ ë°°ì—´)
- source: VARCHAR(50) (ìœ ì…ê²½ë¡œ)
- utm_data: JSONB (ë§ˆì¼€íŒ… ë°ì´í„°)
- notification_sent: BOOLEAN DEFAULT false
- notion_page_id: VARCHAR(100) (ë…¸ì…˜ í˜ì´ì§€ ID)
```

#### consultation_history
```sql
- id: UUID (Primary Key)
- consultation_id: UUID (Foreign Key)
- admin_id: UUID (Foreign Key)
- action: VARCHAR(50) (ìƒíƒœë³€ê²½, ë©”ëª¨ì¶”ê°€, ìŠ¹ì¸ ë“±)
- previous_status: VARCHAR(20)
- new_status: VARCHAR(20)
- comment: TEXT
- created_at: TIMESTAMP
```

#### admin_users (ê¸°ì¡´ í…Œì´ë¸” í™•ì¥)
```sql
- id: UUID (Primary Key)
- email: VARCHAR(255) (Unique)
- name: VARCHAR(100)
- role: ENUM('super_admin', 'admin', 'manager', 'viewer')
- department: VARCHAR(50)
- permissions: JSONB
- is_active: BOOLEAN DEFAULT true
- last_login: TIMESTAMP
- notification_settings: JSONB
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### consultation_stats (í†µê³„ í…Œì´ë¸”)
```sql
- id: UUID (Primary Key)
- date: DATE
- total_consultations: INTEGER
- pending_count: INTEGER
- approved_count: INTEGER
- rejected_count: INTEGER
- completed_count: INTEGER
- conversion_rate: DECIMAL(5,2)
- avg_response_time: INTEGER (ë¶„ ë‹¨ìœ„)
- source_breakdown: JSONB
- created_at: TIMESTAMP
```

#### notification_logs
```sql
- id: UUID (Primary Key)
- consultation_id: UUID (Foreign Key)
- type: ENUM('notion', 'email', 'slack')
- status: ENUM('pending', 'sent', 'failed')
- payload: JSONB
- response: JSONB
- error_message: TEXT
- sent_at: TIMESTAMP
- created_at: TIMESTAMP
```

### 2.2 ë·°(Views) ì„¤ê³„

#### consultation_dashboard_view
```sql
CREATE VIEW consultation_dashboard_view AS
SELECT
    c.id,
    c.consultation_number,
    c.type,
    c.status,
    c.priority,
    c.created_at,
    c.client_info->>'name' as client_name,
    c.client_info->>'email' as client_email,
    c.client_info->>'phone' as client_phone,
    c.client_info->>'company' as company,
    c.budget_range,
    c.timeline,
    a.name as assigned_admin,
    EXTRACT(EPOCH FROM (NOW() - c.created_at)) / 3600 as hours_since_created
FROM consultations c
LEFT JOIN admin_users a ON c.assigned_to = a.id
ORDER BY c.created_at DESC;
```

## 3. API ì„¤ê³„

### 3.1 ê´€ë¦¬ì ì¸ì¦ API
```
POST /api/admin/auth/login
POST /api/admin/auth/logout
POST /api/admin/auth/refresh
GET /api/admin/auth/me
```

### 3.2 ìƒë‹´ ê´€ë¦¬ API
```
GET /api/admin/consultations - ìƒë‹´ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜, í•„í„°ë§)
GET /api/admin/consultations/[id] - ìƒë‹´ ìƒì„¸ ì¡°íšŒ
PUT /api/admin/consultations/[id] - ìƒë‹´ ì •ë³´ ìˆ˜ì •
PUT /api/admin/consultations/[id]/status - ìƒíƒœ ë³€ê²½
PUT /api/admin/consultations/[id]/assign - ë‹´ë‹¹ì í• ë‹¹
POST /api/admin/consultations/[id]/notes - ë©”ëª¨ ì¶”ê°€
DELETE /api/admin/consultations/[id] - ìƒë‹´ ì‚­ì œ
POST /api/admin/consultations/bulk-update - ì¼ê´„ ì²˜ë¦¬
```

### 3.3 í†µê³„ API
```
GET /api/admin/analytics/dashboard - ëŒ€ì‹œë³´ë“œ í†µê³„
GET /api/admin/analytics/consultations - ìƒë‹´ í†µê³„
GET /api/admin/analytics/conversion - ì „í™˜ìœ¨ í†µê³„
GET /api/admin/analytics/source - ìœ ì…ê²½ë¡œ í†µê³„
GET /api/admin/analytics/performance - ì„±ê³¼ ì§€í‘œ
GET /api/admin/analytics/export - ë°ì´í„° ë‚´ë³´ë‚´ê¸°
```

### 3.4 ë…¸ì…˜ ì—°ë™ API
```
POST /api/admin/notion/create-page - ë…¸ì…˜ í˜ì´ì§€ ìƒì„±
PUT /api/admin/notion/update-page - ë…¸ì…˜ í˜ì´ì§€ ì—…ë°ì´íŠ¸
POST /api/admin/notion/send-notification - ì¦‰ì‹œ ì•Œë¦¼ ë°œì†¡
GET /api/admin/notion/status - ì—°ë™ ìƒíƒœ í™•ì¸
```

## 4. ê´€ë¦¬ì í˜ì´ì§€ UI/UX ì„¤ê³„

### 4.1 ëŒ€ì‹œë³´ë“œ (/admin/dashboard)

#### ë©”ì¸ ì§€í‘œ ì¹´ë“œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ì˜¤ëŠ˜ì˜ ì§€í‘œ                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ì‹ ê·œ ìƒë‹´: 12] [ì²˜ë¦¬ ëŒ€ê¸°: 8] [ìŠ¹ì¸: 15] [ì™„ë£Œ: 23]         â”‚
â”‚ [ì „í™˜ìœ¨: 18.5%] [í‰ê·  ì‘ë‹µì‹œê°„: 2.3ì‹œê°„]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì‹¤ì‹œê°„ ìƒë‹´ í˜„í™©
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ ì‹¤ì‹œê°„ ìƒë‹´ í˜„í™©                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ í™ê¸¸ë™ë‹˜ - ì›¹ì‚¬ì´íŠ¸ ì œì‘ ìƒë‹´ (2ë¶„ ì „) [ê¸´ê¸‰]              â”‚
â”‚ â€¢ ê¹€ì² ìˆ˜ë‹˜ - ëª¨ë°”ì¼ ì•± ê°œë°œ (15ë¶„ ì „) [ì¼ë°˜]                 â”‚
â”‚ â€¢ ì´ì˜í¬ë‹˜ - ë¸Œëœë”© ì‘ì—… (1ì‹œê°„ ì „) [ì¼ë°˜]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í†µê³„ ì°¨íŠ¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ ì£¼ê°„ ìƒë‹´ ì¶”ì´                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â–„                                                    â”‚
â”‚      â–„ â–ˆ â–„                                                  â”‚
â”‚    â–„ â–ˆ â–ˆ â–ˆ â–„                                                â”‚
â”‚  â–„ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–„                                              â”‚
â”‚ ì›” í™” ìˆ˜ ëª© ê¸ˆ í†  ì¼                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ìƒë‹´ ê´€ë¦¬ (/admin/consultations)

#### í•„í„° ë° ê²€ìƒ‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” [ê²€ìƒ‰: ê³ ê°ëª…/ì´ë©”ì¼] [ìƒíƒœ: ì „ì²´â–¼] [ê¸°ê°„: ìµœê·¼ 7ì¼â–¼]       â”‚
â”‚ [ë‹´ë‹¹ì: ì „ì²´â–¼] [ìš°ì„ ìˆœìœ„: ì „ì²´â–¼] [ìœ ì…ê²½ë¡œ: ì „ì²´â–¼]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ìƒë‹´ ëª©ë¡ í…Œì´ë¸”
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ ë²ˆí˜¸  â”‚ ê³ ê°ëª…   â”‚ ì—°ë½ì²˜      â”‚ ìƒíƒœ    â”‚ ìš°ì„ ìˆœìœ„ â”‚ ë‹´ë‹¹ì â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¡ C-001 â”‚ í™ê¸¸ë™   â”‚ 010-1234   â”‚ ğŸŸ¡ëŒ€ê¸°  â”‚ ğŸ”´ê¸´ê¸‰   â”‚ ê¹€ê´€ë¦¬ â”‚
â”‚ â–¡ C-002 â”‚ ê¹€ì² ìˆ˜   â”‚ 010-5678   â”‚ ğŸŸ¢ìŠ¹ì¸  â”‚ ğŸŸ¡ì¼ë°˜   â”‚ ì´ë‹´ë‹¹ â”‚
â”‚ â–¡ C-003 â”‚ ì´ì˜í¬   â”‚ 010-9012   â”‚ ğŸ”µê²€í†   â”‚ ğŸŸ¢ë‚®ìŒ   â”‚ ë°•ë§¤ë‹ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì¼ê´„ ì²˜ë¦¬ ë²„íŠ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ì¼ê´„ ìŠ¹ì¸] [ì¼ê´„ ê±°ì ˆ] [ë‹´ë‹¹ì í• ë‹¹] [ìƒíƒœ ë³€ê²½] [ë‚´ë³´ë‚´ê¸°]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ìƒë‹´ ìƒì„¸ (/admin/consultations/[id])

#### ê³ ê° ì •ë³´
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ ê³ ê° ì •ë³´                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ë¦„: í™ê¸¸ë™                íšŒì‚¬: (ì£¼)í…ŒìŠ¤íŠ¸                   â”‚
â”‚ ì—°ë½ì²˜: 010-1234-5678       ì´ë©”ì¼: hong@test.com           â”‚
â”‚ í¬ë§ì—°ë½ì‹œê°„: í‰ì¼ ì˜¤í›„      ìƒë‹´ë²ˆí˜¸: C-001                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í”„ë¡œì íŠ¸ ì •ë³´
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¼ í”„ë¡œì íŠ¸ ì •ë³´                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì„œë¹„ìŠ¤ ìœ í˜•: ì›¹ì‚¬ì´íŠ¸ ì œì‘                                     â”‚
â”‚ í”„ë¡œì íŠ¸ ê·œëª¨: ì¤‘ê°„ ê·œëª¨                                       â”‚
â”‚ ì˜ˆì‚° ë²”ìœ„: 300-500ë§Œì›                                        â”‚
â”‚ í¬ë§ ì¼ì •: 2-3ê°œì›”                                            â”‚
â”‚ ì£¼ìš” ê¸°ëŠ¥: ë°˜ì‘í˜• ë””ìì¸, SEO ìµœì í™”, ê´€ë¦¬ì í˜ì´ì§€             â”‚
â”‚ ì¶”ê°€ ìš”ì²­ì‚¬í•­: ë‹¤êµ­ì–´ ì§€ì› í•„ìš”, ëª¨ë°”ì¼ ìš°ì„  ë””ìì¸             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ìƒíƒœ ê´€ë¦¬
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ìƒíƒœ ê´€ë¦¬                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í˜„ì¬ ìƒíƒœ: [ëŒ€ê¸° ì¤‘ â–¼]    ìš°ì„ ìˆœìœ„: [ì¼ë°˜ â–¼]                  â”‚
â”‚ ë‹´ë‹¹ì: [ê¹€ê´€ë¦¬ì â–¼]      ì˜ˆìƒ ì—°ë½ì‹œê°„: [24ì‹œê°„ ì´ë‚´ â–¼]       â”‚
â”‚ [ìƒíƒœ ë³€ê²½] [ë‹´ë‹¹ì í• ë‹¹] [ìš°ì„ ìˆœìœ„ ë³€ê²½]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ê´€ë¦¬ì ë©”ëª¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ê´€ë¦¬ì ë©”ëª¨                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ë©”ëª¨ ì…ë ¥ ì˜ì—­]                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 2024-01-15 14:30 - ê¹€ê´€ë¦¬ì                             â”‚ â”‚
â”‚ â”‚ ê³ ê°ê³¼ í†µí™” ì™„ë£Œ. ìƒì„¸ ìš”êµ¬ì‚¬í•­ í™•ì¸í•¨.                   â”‚ â”‚
â”‚ â”‚ ë‹¤ìŒì£¼ í™”ìš”ì¼ ë¯¸íŒ… ì˜ˆì •.                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [ë©”ëª¨ ì¶”ê°€]                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì²˜ë¦¬ ì´ë ¥
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ì²˜ë¦¬ ì´ë ¥                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2024-01-15 14:30 - ê¹€ê´€ë¦¬ì: ìƒë‹´ ìŠ¹ì¸                       â”‚
â”‚ 2024-01-15 10:15 - ì‹œìŠ¤í…œ: ë‹´ë‹¹ì í• ë‹¹ (ê¹€ê´€ë¦¬ì)             â”‚
â”‚ 2024-01-15 09:00 - ì‹œìŠ¤í…œ: ìƒë‹´ ì‹ ì²­ ì ‘ìˆ˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 í†µê³„ ë° ë¶„ì„ (/admin/analytics)

#### KPI ëŒ€ì‹œë³´ë“œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š í•µì‹¬ ì§€í‘œ (ì´ë²ˆ ë‹¬)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ ìƒë‹´ìˆ˜: 156ê±´ (â†— 12%)     ì „í™˜ìœ¨: 18.5% (â†— 2.3%)         â”‚
â”‚ í‰ê·  ì‘ë‹µì‹œê°„: 2.1ì‹œê°„ (â†˜ 15ë¶„)  ê³ ê° ë§Œì¡±ë„: 4.7/5.0       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ìœ ì…ê²½ë¡œ ë¶„ì„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ ìœ ì…ê²½ë¡œ ë¶„ì„                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Google ê²€ìƒ‰: 45% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                       â”‚
â”‚ ë„¤ì´ë²„ ê²€ìƒ‰: 28% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                               â”‚
â”‚ ì§ì ‘ ì ‘ì†: 15% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                       â”‚
â”‚ SNS: 8% â–ˆâ–ˆâ–ˆâ–ˆ                                               â”‚
â”‚ ê¸°íƒ€: 4% â–ˆâ–ˆ                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë‹´ë‹¹ìë³„ ì„±ê³¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¥ ë‹´ë‹¹ìë³„ ì„±ê³¼                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ê¹€ê´€ë¦¬ì: ì²˜ë¦¬ 25ê±´, ì „í™˜ìœ¨ 22%, í‰ê· ì‘ë‹µ 1.8ì‹œê°„              â”‚
â”‚ ì´ë‹´ë‹¹ì: ì²˜ë¦¬ 18ê±´, ì „í™˜ìœ¨ 19%, í‰ê· ì‘ë‹µ 2.3ì‹œê°„              â”‚
â”‚ ë°•ë§¤ë‹ˆì €: ì²˜ë¦¬ 31ê±´, ì „í™˜ìœ¨ 16%, í‰ê· ì‘ë‹µ 2.8ì‹œê°„              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. ë…¸ì…˜ ì—°ë™ ë° í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ

### 5.1 ë…¸ì…˜ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

#### Consultation Database (ë…¸ì…˜)
```
ì†ì„± ì„¤ì •:
- ìƒë‹´ë²ˆí˜¸: Title
- ê³ ê°ëª…: Text
- íšŒì‚¬ëª…: Text
- ì—°ë½ì²˜: Phone
- ì´ë©”ì¼: Email
- ìƒë‹´ìœ í˜•: Select (ê°€ì´ë“œí˜•, ììœ í˜•)
- ìƒíƒœ: Select (ëŒ€ê¸°, ê²€í† ì¤‘, ìŠ¹ì¸, ê±°ì ˆ, ì™„ë£Œ)
- ìš°ì„ ìˆœìœ„: Select (ë‚®ìŒ, ì¼ë°˜, ë†’ìŒ, ê¸´ê¸‰)
- ë‹´ë‹¹ì: Person
- ì˜ˆì‚°ë²”ìœ„: Text
- í¬ë§ì¼ì •: Text
- ìƒì„±ì¼: Created time
- ìˆ˜ì •ì¼: Last edited time
- í”„ë¡œì íŠ¸ì„¤ëª…: Rich text
- ê´€ë¦¬ìë©”ëª¨: Rich text
```

### 5.2 ë…¸ì…˜ API ì—°ë™ êµ¬í˜„

#### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```env
NOTION_API_KEY=secret_xxxxxxxxx
NOTION_DATABASE_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
NOTION_WEBHOOK_SECRET=your_webhook_secret
```

#### ë…¸ì…˜ í˜ì´ì§€ ìƒì„± ë¡œì§
```typescript
// utils/notionClient.ts
import { Client } from '@notionhq/client';

export class NotionService {
  private notion: Client;
  private databaseId: string;

  constructor() {
    this.notion = new Client({
      auth: process.env.NOTION_API_KEY,
    });
    this.databaseId = process.env.NOTION_DATABASE_ID!;
  }

  async createConsultationPage(consultation: ConsultationData) {
    const response = await this.notion.pages.create({
      parent: { database_id: this.databaseId },
      properties: {
        'ìƒë‹´ë²ˆí˜¸': {
          title: [{ text: { content: consultation.consultation_number } }]
        },
        'ê³ ê°ëª…': {
          rich_text: [{ text: { content: consultation.client_info.name } }]
        },
        'íšŒì‚¬ëª…': {
          rich_text: [{ text: { content: consultation.client_info.company || '' } }]
        },
        'ì—°ë½ì²˜': {
          phone_number: consultation.client_info.phone
        },
        'ì´ë©”ì¼': {
          email: consultation.client_info.email
        },
        'ìƒë‹´ìœ í˜•': {
          select: { name: consultation.type === 'guided' ? 'ê°€ì´ë“œí˜•' : 'ììœ í˜•' }
        },
        'ìƒíƒœ': {
          select: { name: 'ëŒ€ê¸°' }
        },
        'ìš°ì„ ìˆœìœ„': {
          select: { name: 'ì¼ë°˜' }
        },
        'ì˜ˆì‚°ë²”ìœ„': {
          rich_text: [{ text: { content: consultation.budget_range || '' } }]
        },
        'í¬ë§ì¼ì •': {
          rich_text: [{ text: { content: consultation.timeline || '' } }]
        }
      }
    });

    return response.id;
  }

  async updateConsultationStatus(pageId: string, status: string, assignedTo?: string) {
    await this.notion.pages.update({
      page_id: pageId,
      properties: {
        'ìƒíƒœ': {
          select: { name: this.mapStatusToKorean(status) }
        },
        ...(assignedTo && {
          'ë‹´ë‹¹ì': {
            people: [{ id: assignedTo }]
          }
        })
      }
    });
  }

  private mapStatusToKorean(status: string): string {
    const statusMap = {
      'pending': 'ëŒ€ê¸°',
      'reviewing': 'ê²€í† ì¤‘',
      'approved': 'ìŠ¹ì¸',
      'rejected': 'ê±°ì ˆ',
      'completed': 'ì™„ë£Œ'
    };
    return statusMap[status] || 'ëŒ€ê¸°';
  }
}
```

### 5.3 ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

#### Webhook íŠ¸ë¦¬ê±° ì„¤ì •
```typescript
// api/webhooks/consultation-created.ts
export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const consultation = req.body;

  try {
    // 1. ë…¸ì…˜ í˜ì´ì§€ ìƒì„±
    const notionService = new NotionService();
    const pageId = await notionService.createConsultationPage(consultation);

    // 2. ìƒë‹´ í…Œì´ë¸”ì— ë…¸ì…˜ í˜ì´ì§€ ID ì €ì¥
    await supabase
      .from('consultations')
      .update({ notion_page_id: pageId })
      .eq('id', consultation.id);

    // 3. ì¦‰ì‹œ ì•Œë¦¼ ë°œì†¡
    await sendImmediateNotification(consultation, pageId);

    res.status(200).json({ success: true, pageId });
  } catch (error) {
    console.error('Webhook error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
}
```

#### ì¦‰ì‹œ ì•Œë¦¼ ë°œì†¡
```typescript
async function sendImmediateNotification(consultation: any, pageId: string) {
  const notificationData = {
    type: 'new_consultation',
    consultation_id: consultation.id,
    consultation_number: consultation.consultation_number,
    client_name: consultation.client_info.name,
    client_email: consultation.client_info.email,
    client_phone: consultation.client_info.phone,
    consultation_type: consultation.type,
    budget_range: consultation.budget_range,
    timeline: consultation.timeline,
    notion_page_id: pageId,
    notion_url: `https://notion.so/${pageId}`,
    admin_url: `${process.env.NEXT_PUBLIC_URL}/admin/consultations/${consultation.id}`
  };

  // ì—¬ëŸ¬ ì±„ë„ë¡œ ì•Œë¦¼ ë°œì†¡
  await Promise.all([
    sendSlackNotification(notificationData),
    sendEmailNotification(notificationData),
    sendDiscordNotification(notificationData)
  ]);
}
```

### 5.4 ì•Œë¦¼ í…œí”Œë¦¿

#### Slack ì•Œë¦¼ í…œí”Œë¦¿
```json
{
  "text": "ğŸ†• ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!",
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "ğŸ†• ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­"
      }
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*ê³ ê°ëª…:* {{client_name}}"
        },
        {
          "type": "mrkdwn",
          "text": "*ìƒë‹´ë²ˆí˜¸:* {{consultation_number}}"
        },
        {
          "type": "mrkdwn",
          "text": "*ì—°ë½ì²˜:* {{client_phone}}"
        },
        {
          "type": "mrkdwn",
          "text": "*ì´ë©”ì¼:* {{client_email}}"
        },
        {
          "type": "mrkdwn",
          "text": "*ìƒë‹´ìœ í˜•:* {{consultation_type}}"
        },
        {
          "type": "mrkdwn",
          "text": "*ì˜ˆì‚°ë²”ìœ„:* {{budget_range}}"
        }
      ]
    },
    {
      "type": "actions",
      "elements": [
        {
          "type": "button",
          "text": {
            "type": "plain_text",
            "text": "ë…¸ì…˜ì—ì„œ ë³´ê¸°"
          },
          "url": "{{notion_url}}",
          "style": "primary"
        },
        {
          "type": "button",
          "text": {
            "type": "plain_text",
            "text": "ê´€ë¦¬ìì—ì„œ ë³´ê¸°"
          },
          "url": "{{admin_url}}"
        }
      ]
    }
  ]
}
```

#### ì´ë©”ì¼ ì•Œë¦¼ í…œí”Œë¦¿
```html
<!DOCTYPE html>
<html>
<head>
    <title>ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­ ì•Œë¦¼</title>
</head>
<body style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
        <h2 style="color: #333; margin-bottom: 20px;">ğŸ†• ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤</h2>

        <div style="background: white; padding: 20px; border-radius: 6px; margin-bottom: 20px;">
            <h3 style="color: #555; margin-top: 0;">ê³ ê° ì •ë³´</h3>
            <p><strong>ê³ ê°ëª…:</strong> {{client_name}}</p>
            <p><strong>ì—°ë½ì²˜:</strong> {{client_phone}}</p>
            <p><strong>ì´ë©”ì¼:</strong> {{client_email}}</p>
            <p><strong>ìƒë‹´ë²ˆí˜¸:</strong> {{consultation_number}}</p>
        </div>

        <div style="background: white; padding: 20px; border-radius: 6px; margin-bottom: 20px;">
            <h3 style="color: #555; margin-top: 0;">í”„ë¡œì íŠ¸ ì •ë³´</h3>
            <p><strong>ìƒë‹´ìœ í˜•:</strong> {{consultation_type}}</p>
            <p><strong>ì˜ˆì‚°ë²”ìœ„:</strong> {{budget_range}}</p>
            <p><strong>í¬ë§ì¼ì •:</strong> {{timeline}}</p>
        </div>

        <div style="text-align: center;">
            <a href="{{notion_url}}" style="background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; margin-right: 10px;">ë…¸ì…˜ì—ì„œ ë³´ê¸°</a>
            <a href="{{admin_url}}" style="background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px;">ê´€ë¦¬ìì—ì„œ ì²˜ë¦¬</a>
        </div>
    </div>
</body>
</html>
```

## 6. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ

### 6.1 Supabase Realtime ì„¤ì •
```typescript
// hooks/useRealtimeConsultations.ts
import { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabase';

export function useRealtimeConsultations() {
  const [consultations, setConsultations] = useState([]);
  const [newConsultationAlert, setNewConsultationAlert] = useState(null);

  useEffect(() => {
    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    loadConsultations();

    // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
    const subscription = supabase
      .channel('consultations_channel')
      .on('postgres_changes',
        {
          event: 'INSERT',
          schema: 'public',
          table: 'consultations'
        },
        (payload) => {
          console.log('ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­:', payload.new);
          setConsultations(prev => [payload.new, ...prev]);
          setNewConsultationAlert(payload.new);

          // ë¸Œë¼ìš°ì € ì•Œë¦¼
          if (Notification.permission === 'granted') {
            new Notification('ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­', {
              body: `${payload.new.client_info?.name}ë‹˜ì˜ ìƒë‹´ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.`,
              icon: '/favicon.ico'
            });
          }
        }
      )
      .on('postgres_changes',
        {
          event: 'UPDATE',
          schema: 'public',
          table: 'consultations'
        },
        (payload) => {
          console.log('ìƒë‹´ ì—…ë°ì´íŠ¸:', payload.new);
          setConsultations(prev =>
            prev.map(item =>
              item.id === payload.new.id ? payload.new : item
            )
          );
        }
      )
      .subscribe();

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  const loadConsultations = async () => {
    const { data, error } = await supabase
      .from('consultation_dashboard_view')
      .select('*')
      .order('created_at', { ascending: false })
      .limit(50);

    if (data) setConsultations(data);
  };

  return {
    consultations,
    newConsultationAlert,
    dismissAlert: () => setNewConsultationAlert(null)
  };
}
```

### 6.2 ì‹¤ì‹œê°„ ì•Œë¦¼ ì»´í¬ë„ŒíŠ¸
```typescript
// components/admin/RealtimeNotification.tsx
export function RealtimeNotification() {
  const { newConsultationAlert, dismissAlert } = useRealtimeConsultations();
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    if (newConsultationAlert) {
      setIsVisible(true);
      // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
      setTimeout(() => {
        setIsVisible(false);
        dismissAlert();
      }, 5000);
    }
  }, [newConsultationAlert]);

  if (!isVisible || !newConsultationAlert) return null;

  return (
    <div className="fixed top-4 right-4 bg-blue-500 text-white p-4 rounded-lg shadow-lg z-50 animate-slide-in">
      <div className="flex items-start gap-3">
        <div className="flex-shrink-0">
          ğŸ†•
        </div>
        <div className="flex-1">
          <h4 className="font-semibold">ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­</h4>
          <p className="text-sm opacity-90">
            {newConsultationAlert.client_info?.name}ë‹˜ì˜ ìƒë‹´ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.
          </p>
        </div>
        <button
          onClick={() => {
            setIsVisible(false);
            dismissAlert();
          }}
          className="flex-shrink-0 text-white/70 hover:text-white"
        >
          âœ•
        </button>
      </div>
      <div className="mt-3 flex gap-2">
        <Link
          href={`/admin/consultations/${newConsultationAlert.id}`}
          className="bg-white/20 hover:bg-white/30 px-3 py-1 rounded text-sm"
        >
          ë°”ë¡œ í™•ì¸
        </Link>
      </div>
    </div>
  );
}
```

## 7. ë³´ì•ˆ ë° ê¶Œí•œ ê´€ë¦¬

### 7.1 ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)
```typescript
// utils/permissions.ts
export const PERMISSIONS = {
  CONSULTATION_VIEW: 'consultation:view',
  CONSULTATION_EDIT: 'consultation:edit',
  CONSULTATION_DELETE: 'consultation:delete',
  CONSULTATION_ASSIGN: 'consultation:assign',
  ANALYTICS_VIEW: 'analytics:view',
  USER_MANAGE: 'user:manage',
  SYSTEM_CONFIG: 'system:config'
};

export const ROLE_PERMISSIONS = {
  viewer: [PERMISSIONS.CONSULTATION_VIEW],
  manager: [
    PERMISSIONS.CONSULTATION_VIEW,
    PERMISSIONS.CONSULTATION_EDIT,
    PERMISSIONS.CONSULTATION_ASSIGN,
    PERMISSIONS.ANALYTICS_VIEW
  ],
  admin: [
    ...ROLE_PERMISSIONS.manager,
    PERMISSIONS.CONSULTATION_DELETE,
    PERMISSIONS.USER_MANAGE
  ],
  super_admin: [
    ...ROLE_PERMISSIONS.admin,
    PERMISSIONS.SYSTEM_CONFIG
  ]
};
```

### 7.2 API ë³´ì•ˆ
```typescript
// middleware/auth.ts
export async function withAdminAuth(handler: NextApiHandler) {
  return async (req: NextApiRequest, res: NextApiResponse) => {
    try {
      const token = req.headers.authorization?.replace('Bearer ', '');

      if (!token) {
        return res.status(401).json({ error: 'Unauthorized' });
      }

      const { data: user, error } = await supabase.auth.getUser(token);

      if (error || !user) {
        return res.status(401).json({ error: 'Invalid token' });
      }

      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      const { data: adminUser } = await supabase
        .from('admin_users')
        .select('*')
        .eq('email', user.user.email)
        .eq('is_active', true)
        .single();

      if (!adminUser) {
        return res.status(403).json({ error: 'Access denied' });
      }

      req.user = user.user;
      req.adminUser = adminUser;

      return handler(req, res);
    } catch (error) {
      return res.status(500).json({ error: 'Internal server error' });
    }
  };
}
```

## 8. ì„±ëŠ¥ ìµœì í™”

### 8.1 ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤
```sql
-- ìƒë‹´ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_consultations_status ON consultations(status);
CREATE INDEX idx_consultations_created_at ON consultations(created_at DESC);
CREATE INDEX idx_consultations_assigned_to ON consultations(assigned_to);
CREATE INDEX idx_consultations_priority ON consultations(priority);

-- ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_consultations_status_created ON consultations(status, created_at DESC);
CREATE INDEX idx_consultations_assigned_status ON consultations(assigned_to, status);

-- í†µê³„ ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_consultation_stats_date ON consultation_stats(date DESC);
```

### 8.2 ìºì‹± ì „ëµ
```typescript
// utils/cache.ts
import Redis from 'ioredis';

const redis = new Redis(process.env.REDIS_URL);

export class CacheService {
  static async get(key: string) {
    const value = await redis.get(key);
    return value ? JSON.parse(value) : null;
  }

  static async set(key: string, value: any, ttl = 300) {
    await redis.setex(key, ttl, JSON.stringify(value));
  }

  static async invalidate(pattern: string) {
    const keys = await redis.keys(pattern);
    if (keys.length > 0) {
      await redis.del(...keys);
    }
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
export async function getCachedDashboardStats() {
  const cacheKey = 'dashboard:stats';
  let stats = await CacheService.get(cacheKey);

  if (!stats) {
    stats = await calculateDashboardStats();
    await CacheService.set(cacheKey, stats, 60); // 1ë¶„ ìºì‹œ
  }

  return stats;
}
```

## 9. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 9.1 ë¡œê¹… ì‹œìŠ¤í…œ
```typescript
// utils/logger.ts
export class Logger {
  static info(message: string, data?: any) {
    console.log(`[INFO] ${new Date().toISOString()} - ${message}`, data);
  }

  static error(message: string, error?: any) {
    console.error(`[ERROR] ${new Date().toISOString()} - ${message}`, error);
  }

  static audit(action: string, userId: string, resourceId?: string, details?: any) {
    const logEntry = {
      timestamp: new Date().toISOString(),
      action,
      userId,
      resourceId,
      details,
      ip: getClientIP(),
      userAgent: getUserAgent()
    };

    // ë°ì´í„°ë² ì´ìŠ¤ì— ê°ì‚¬ ë¡œê·¸ ì €ì¥
    supabase.from('audit_logs').insert(logEntry);
  }
}
```

### 9.2 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```typescript
// utils/monitoring.ts
export class PerformanceMonitor {
  static async trackApiCall(endpoint: string, method: string, duration: number, status: number) {
    await supabase.from('api_performance').insert({
      endpoint,
      method,
      duration,
      status,
      timestamp: new Date().toISOString()
    });
  }

  static async trackConsultationMetrics(consultationId: string, action: string) {
    await supabase.from('consultation_metrics').insert({
      consultation_id: consultationId,
      action,
      timestamp: new Date().toISOString()
    });
  }
}
```

## 10. ë°°í¬ ë° ìš´ì˜

### 10.1 í™˜ê²½ ì„¤ì •
```env
# í”„ë¡œë•ì…˜ í™˜ê²½ ë³€ìˆ˜
NODE_ENV=production
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# ë…¸ì…˜ ì—°ë™
NOTION_API_KEY=secret_xxxxxxxxx
NOTION_DATABASE_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# ì•Œë¦¼ ì„œë¹„ìŠ¤
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/xxx
SMTP_HOST=smtp.gmail.com
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# Redis ìºì‹œ
REDIS_URL=redis://localhost:6379

# ëª¨ë‹ˆí„°ë§
SENTRY_DSN=https://xxx@sentry.io/xxx
```

### 10.2 Docker ì„¤ì •
```dockerfile
# Dockerfile
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:18-alpine AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
EXPOSE 3000
CMD ["node", "server.js"]
```

### 10.3 CI/CD íŒŒì´í”„ë¼ì¸
```yaml
# .github/workflows/deploy.yml
name: Deploy Admin Dashboard
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build application
        run: npm run build
        env:
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}

      - name: Deploy to production
        run: |
          # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
          ./deploy.sh
```

## 11. í…ŒìŠ¤íŠ¸ ì „ëµ

### 11.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```typescript
// __tests__/services/consultation.test.ts
import { ConsultationService } from '@/services/consultation';

describe('ConsultationService', () => {
  test('should create consultation successfully', async () => {
    const consultationData = {
      type: 'guided',
      client_info: {
        name: 'í™ê¸¸ë™',
        email: 'hong@test.com',
        phone: '010-1234-5678'
      }
    };

    const result = await ConsultationService.create(consultationData);

    expect(result).toHaveProperty('consultation_number');
    expect(result.status).toBe('pending');
  });
});
```

### 11.2 í†µí•© í…ŒìŠ¤íŠ¸
```typescript
// __tests__/integration/notification.test.ts
import { NotionService } from '@/services/notion';
import { SlackService } from '@/services/slack';

describe('Notification Integration', () => {
  test('should send notification to all channels', async () => {
    const consultationData = createMockConsultation();

    // ë…¸ì…˜ í˜ì´ì§€ ìƒì„±
    const pageId = await NotionService.createPage(consultationData);
    expect(pageId).toBeTruthy();

    // Slack ì•Œë¦¼ ë°œì†¡
    const slackResult = await SlackService.sendNotification(consultationData);
    expect(slackResult.success).toBe(true);
  });
});
```

## 12. í–¥í›„ í™•ì¥ ê³„íš

### 12.1 AI ê¸°ë°˜ ê¸°ëŠ¥
- ìƒë‹´ ë‚´ìš© ìë™ ë¶„ë¥˜ ë° íƒœê¹…
- ì‘ë‹µ ì‹œê°„ ì˜ˆì¸¡ ëª¨ë¸
- ê³ ê° ë§Œì¡±ë„ ì˜ˆì¸¡
- ìë™ ë‹´ë‹¹ì ì¶”ì²œ

### 12.2 ê³ ê¸‰ ë¶„ì„ ê¸°ëŠ¥
- ì „í™˜ìœ¨ ì˜ˆì¸¡ ëª¨ë¸
- A/B í…ŒìŠ¤íŠ¸ í”Œë«í¼
- ê³ ê° ì—¬ì • ë¶„ì„
- ROI ê³„ì‚°ê¸°

### 12.3 ëª¨ë°”ì¼ ì•±
- React Native ê¸°ë°˜ ê´€ë¦¬ì ì•±
- í‘¸ì‹œ ì•Œë¦¼ ì§€ì›
- ì˜¤í”„ë¼ì¸ ëª¨ë“œ
- ìŒì„± ë©”ëª¨ ê¸°ëŠ¥

ì´ ì„¤ê³„ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¨ê³„ì ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ íš¨ìœ¨ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ìƒë‹´ ê´€ë¦¬ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.